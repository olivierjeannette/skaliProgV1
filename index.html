<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <title>Skali Prog - Performance Training System</title>

        <!-- Favicon -->
        <link rel="icon" type="image/webp" href="js/img/logo.webp" />
        <link rel="shortcut icon" type="image/webp" href="js/img/logo.webp" />

        <!-- Preload logo - CRITIQUE pour LCP -->
        <link rel="preload" as="image" href="js/img/logo.webp" fetchpriority="high" />

        <!-- PWA Manifest -->
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#3e8e41" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="Skali Prog" />
        <link rel="apple-touch-icon" href="js/img/logo.webp" />

        <!-- Fonts - Charg√©s en async pour ne pas bloquer le LCP -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
            rel="stylesheet"
            media="print"
            onload="
                this.media = 'all';
                this.onload = null;
            "
        />
        <noscript
            ><link
                href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
                rel="stylesheet"
        /></noscript>

        <!-- Preload CSS critiques AVANT de les charger -->
        <link rel="preload" href="css/master-theme.css?v=2.4.7" as="style" />
        <link
            rel="preload"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            as="style"
        />

        <!-- Font Awesome - Critique pour les ic√¥nes -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Libraries JS - Toutes en DEFER pour ne pas bloquer le LCP -->
        <script src="https://cdn.tailwindcss.com" defer></script>
        <script>
            // Config Tailwind avant le chargement
            window.tailwindConfig = {
                darkMode: 'class',
                corePlugins: {
                    preflight: false // D√©sactive le reset CSS de Tailwind qui √©crase nos styles
                }
            };
        </script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
            defer
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"
            defer
        ></script>

        <!-- ================================= -->
        <!-- MASTER THEME CSS - UNIFIED GORILLA GLASS DESIGN (CRITIQUE - CHARG√â EN PRIORIT√â) -->
        <!-- ================================= -->
        <link rel="stylesheet" href="css/master-theme.css?v=2.4.7" />

        <!-- MODE PERFORMANCE ULTRA - D√©sactive tous les effets co√ªteux pour am√©liorer l'INP -->
        <link rel="stylesheet" href="css/performance-mode.css?v=1.0.0" />

        <!-- AUTRES CSS - CHARG√âS EN LAZY POUR AM√âLIORER LE LCP -->
        <link
            rel="stylesheet"
            href="css/gym-inventory.css?v=2.4.7"
            media="print"
            onload="this.media = 'all'"
        />
        <link
            rel="stylesheet"
            href="css/nutrition-pro-contrast.css?v=1.0.0"
            media="print"
            onload="this.media = 'all'"
        />
        <link rel="stylesheet" href="css/programming-pro.css?v=2.5.2" />
        <link
            rel="stylesheet"
            href="css/modules-pages.css?v=1.0.0"
            media="print"
            onload="this.media = 'all'"
        />
        <link
            rel="stylesheet"
            href="css/modules-config.css?v=1.0.0"
            media="print"
            onload="this.media = 'all'"
        />
        <link
            rel="stylesheet"
            href="css/calendar-mobile-fullpage.css?v=1.0.0"
            media="print"
            onload="this.media = 'all'"
        />

        <!-- MODE TV 1080p - Optimisation pour √©crans TV HD -->
        <link
            rel="stylesheet"
            href="css/tvmode-1080p.css?v=1.0.0"
            media="print"
            onload="this.media = 'all'"
        />

        <!-- Fallback pour les navigateurs sans JS -->
        <noscript>
            <link rel="stylesheet" href="css/gym-inventory.css?v=2.4.7" />
            <link rel="stylesheet" href="css/nutrition-pro-contrast.css?v=1.0.0" />
            <link rel="stylesheet" href="css/programming-pro.css?v=2.5.2" />
            <link rel="stylesheet" href="css/modules-pages.css?v=1.0.0" />
            <link rel="stylesheet" href="css/modules-config.css?v=1.0.0" />
            <link rel="stylesheet" href="css/calendar-mobile-fullpage.css?v=1.0.0" />
            <link rel="stylesheet" href="css/tvmode-1080p.css?v=1.0.0" />
        </noscript>

        <!-- Critical CSS - Login Screen GORILLA GLASS HERO -->
        <style>
            .hidden {
                display: none !important;
            }

            /* Login screen - GORILLA GLASS + BLOOM + OPTIMIS√â LCP */
            #loginScreen {
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                background: linear-gradient(135deg, #0a0f0a 0%, #0f1810 50%, #0a0f0a 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 50;
            }

            .auth-container {
                max-width: 420px;
                width: 100%;
                padding: 32px;
            }

            .auth-card {
                background: rgba(255, 255, 255, 0.03);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 24px;
                padding: 48px 40px;
                box-shadow:
                    0 20px 60px rgba(0, 0, 0, 0.5),
                    0 0 20px rgba(255, 255, 255, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.05);
            }

            .auth-header {
                text-align: center;
                margin-bottom: 40px;
            }

            .auth-logo {
                width: 80px;
                height: 80px;
                margin: 0 auto 24px;
                background: rgba(255, 255, 255, 0.05);
                border: 2px solid rgba(255, 255, 255, 0.08);
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
                transition: all 0.3s;
            }

            .auth-logo:hover {
                transform: scale(1.05);
                border-color: rgba(255, 255, 255, 0.2);
                box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);
            }

            .logo-image {
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
            }

            /* H1 - √âL√âMENT LCP CRITIQUE - GORILLA GLASS */
            .auth-title {
                font-size: 28px;
                font-weight: 700;
                color: #fff;
                margin-bottom: 8px;
                line-height: 1.2;
                letter-spacing: -0.02em;
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.15);
            }

            .auth-subtitle {
                font-size: 15px;
                color: rgba(255, 255, 255, 0.6);
                font-weight: 400;
            }

            .auth-form {
                margin-top: 32px;
            }
            .auth-input-group {
                margin-bottom: 20px;
            }

            .auth-input {
                width: 100%;
                padding: 14px 16px;
                background: rgba(255, 255, 255, 0.03);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                color: #fff;
                font-size: 15px;
                outline: none;
                transition: all 0.2s;
            }

            .auth-input:focus {
                border-color: rgba(255, 255, 255, 0.2);
                background: rgba(255, 255, 255, 0.06);
                box-shadow:
                    0 0 0 3px rgba(255, 255, 255, 0.05),
                    0 0 15px rgba(255, 255, 255, 0.1);
            }

            .auth-input::placeholder {
                color: rgba(255, 255, 255, 0.4);
            }

            .auth-button {
                width: 100%;
                padding: 14px 24px;
                background: linear-gradient(
                    135deg,
                    var(--accent-primary) 0%,
                    var(--accent-secondary) 100%
                );
                color: white;
                font-size: 15px;
                font-weight: 700;
                border: none;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: 24px;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                box-shadow: var(--shadow-lg);
            }

            .auth-button:hover {
                background: linear-gradient(
                    135deg,
                    var(--accent-secondary) 0%,
                    var(--accent-primary) 100%
                );
                transform: translateY(-2px);
                box-shadow: var(--shadow-2xl);
            }

            .auth-button:active {
                transform: translateY(0);
            }

            .auth-info {
                text-align: center;
                margin-top: 20px;
                font-size: 13px;
                color: rgba(255, 255, 255, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            .auth-error {
                background: rgba(239, 68, 68, 0.1);
                border: 1px solid rgba(239, 68, 68, 0.3);
                backdrop-filter: blur(10px);
                color: #fca5a5;
                padding: 12px;
                border-radius: 10px;
                font-size: 14px;
                text-align: center;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: 16px;
            }

            @media (max-width: 500px) {
                .auth-card {
                    padding: 32px 24px;
                }
                .auth-title {
                    font-size: 24px;
                }
                .auth-logo {
                    width: 70px;
                    height: 70px;
                }
            }
        </style>
    </head>
    <body>
        <div id="app" class="min-h-screen">
            <!-- Login Screen Premium -->
            <div id="loginScreen">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <div class="auth-logo">
                                <img
                                    src="js/img/logo.webp"
                                    alt="Logo"
                                    class="logo-image"
                                    width="80"
                                    height="80"
                                />
                            </div>
                            <h1 class="auth-title">SKALI PROG</h1>
                            <p class="auth-subtitle">Performance Training System</p>
                        </div>

                        <div class="auth-form">
                            <div class="auth-input-group">
                                <input
                                    type="password"
                                    id="loginPassword"
                                    placeholder="Mot de passe administrateur"
                                    class="auth-input"
                                    onkeypress="
                                        if (event.key === 'Enter' && typeof Auth !== 'undefined')
                                            Auth.login();
                                    "
                                />
                            </div>

                            <button
                                onclick="if (typeof Auth !== 'undefined') Auth.login();"
                                class="auth-button"
                            >
                                <span>‚Üí</span>
                                <span>Connexion</span>
                            </button>

                            <div class="auth-info">
                                <span>üîí</span>
                                <span>Acc√®s administrateur s√©curis√©</span>
                            </div>
                        </div>

                        <div id="loginError" class="auth-error hidden">
                            <span>‚ö†Ô∏è</span>
                            <span>Mot de passe incorrect</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main App Premium -->
            <div id="mainApp" class="hidden">
                <!-- Header Mobile (visible seulement sur mobile) -->
                <header class="mobile-header">
                    <div class="mobile-header-logo">
                        <i class="fas fa-dumbbell"></i>
                        <span>SKALI PROG</span>
                    </div>
                    <button
                        id="mobileMenuBtn"
                        class="mobile-menu-toggle"
                        onclick="toggleMobileMenu()"
                    >
                        <i class="fas fa-bars"></i>
                    </button>
                </header>

                <!-- Overlay sombre pour mobile -->
                <div id="mobileOverlay" class="mobile-overlay" onclick="closeMobileMenu()"></div>

                <!-- Sidebar Navigation -->
                <aside class="sidebar">
                    <!-- Logo & Brand -->
                    <div class="sidebar-header">
                        <div class="logo-container">
                            <i class="fas fa-home logo-icon"></i>
                            <span class="logo-text">SKALI PROG</span>
                        </div>

                        <!-- Status Indicator -->
                        <div id="syncStatus" class="sync-status">
                            <div id="syncStatusDot" class="status-dot offline"></div>
                            <span id="syncStatusText" class="text-xs font-medium">Hors ligne</span>
                        </div>
                    </div>

                    <!-- Navigation Menu -->
                    <nav class="sidebar-nav">
                        <!-- ACC√àS PORTAIL -->
                        <div class="nav-section">
                            <h3 class="nav-section-title">Portail Adh√©rents</h3>
                            <button
                                onclick="PortalAccess_showPortalAccessView()"
                                id="portalAccessBtn"
                                class="nav-item nav-item-highlight"
                                title="G√©rer l'acc√®s au portail adh√©rents"
                            >
                                <i class="fas fa-share-alt"></i>
                                <span>Acc√®s Portail</span>
                            </button>
                        </div>

                        <!-- NAVIGATION -->
                        <div class="nav-section">
                            <h3 class="nav-section-title">Navigation</h3>
                            <button
                                onclick="
                                    if (typeof ViewManager !== 'undefined')
                                        ViewManager.showView('calendar');
                                "
                                id="calendarBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-calendar-alt"></i>
                                <span>Planning</span>
                            </button>
                            <button
                                onclick="
                                    if (typeof ViewManager !== 'undefined')
                                        ViewManager.showView('members');
                                "
                                id="membersBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-users"></i>
                                <span>Adh√©rents</span>
                            </button>
                            <button
                                onclick="
                                    if (typeof ViewManager !== 'undefined')
                                        ViewManager.showView('teams');
                                "
                                id="teamsBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-users-cog"></i>
                                <span>TeamBuilder</span>
                            </button>
                            <button
                                onclick="CardioDraw_showCardioDraw()"
                                class="nav-item"
                                title="Cr√©er des groupes cardio al√©atoires"
                            >
                                <i class="fas fa-random"></i>
                                <span>Tirage Cardio</span>
                            </button>
                            <button
                                onclick="RunSessionManager_open()"
                                id="runSessionBtn"
                                class="nav-item"
                                title="Gestion de s√©ances de course avec chrono"
                            >
                                <i class="fas fa-running"></i>
                                <span>S√©ances Course</span>
                            </button>
                        </div>

                        <!-- SYNCHRONISATION -->
                        <div class="nav-section" style="display: none">
                            <h3 class="nav-section-title">Synchronisation</h3>
                            <!-- Importer et Publier retir√©s du menu -->
                        </div>

                        <!-- CRM -->
                        <div class="nav-section">
                            <h3 class="nav-section-title">CRM</h3>
                            <button
                                onclick="CRMManager_show()"
                                id="crmBtn"
                                class="nav-item"
                                title="Gestion des leads des sites web La Sk√†li"
                            >
                                <i class="fas fa-chart-line"></i>
                                <span>CRM - Leads</span>
                            </button>
                            <button
                                onclick="CRMAnalytics_show()"
                                id="crmAnalyticsBtn"
                                class="nav-item"
                                title="Dashboard analytics et statistiques du site"
                            >
                                <i class="fas fa-chart-bar"></i>
                                <span>CRM - Stats</span>
                            </button>
                        </div>

                        <!-- OUTILS -->
                        <div class="nav-section">
                            <h3 class="nav-section-title">Outils</h3>
                            <button onclick="PDFExporter.openWeekSelector()" class="nav-item">
                                <i class="fas fa-file-pdf"></i>
                                <span>Export PDF</span>
                            </button>
                            <button
                                onclick="DiscordUnified_initAndShow()"
                                class="nav-item"
                                title="Gestion compl√®te Discord : Notifications, Liaison membres et Bot"
                            >
                                <i class="fab fa-discord"></i>
                                <span>Discord</span>
                            </button>
                            <button
                                onclick="
                                    if (typeof MorningCoachPage !== 'undefined')
                                        MorningCoachPage.showView();
                                "
                                id="morningCoachBtn"
                                class="nav-item"
                                title="Notifications matinales automatiques avec s√©ance + warm-up IA"
                            >
                                <i class="fas fa-sun"></i>
                                <span>Morning Coach</span>
                            </button>
                            <!-- Anciens modules Discord fusionn√©s dans DiscordUnified -->
                            <button
                                onclick="
                                    if (typeof ConfigManagerPage !== 'undefined')
                                        ConfigManagerPage.showView();
                                "
                                id="configBtn"
                                class="nav-item"
                                title="Configuration s√©curis√©e (Admin)"
                            >
                                <i class="fas fa-cog"></i>
                                <span>Configuration</span>
                            </button>
                        </div>

                        <!-- MODULES AVANC√âS -->
                        <div class="nav-section">
                            <h3 class="nav-section-title">Modules Avanc√©s</h3>
                            <button
                                onclick="ProgrammingPro_init()"
                                id="programmingProBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-dumbbell"></i>
                                <span>Programmation Pro</span>
                            </button>
                            <button
                                onclick="NutritionPro_init()"
                                id="nutritionProBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-utensils"></i>
                                <span>Nutrition Pro</span>
                            </button>
                            <button
                                onclick="CardioSessionManager_show()"
                                id="cardioSessionBtn"
                                class="nav-item"
                            >
                                <i class="fas fa-heartbeat"></i>
                                <span>Cardio Session Manager</span>
                            </button>
                        </div>
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div id="mainContent" class="content-wrapper"></div>
                </main>
            </div>
        </div>

        <!-- Modal Container -->
        <div id="modalContainer"></div>

        <!-- Scripts - Architecture Modulaire OPTIMIS√âE avec Lazy Loading -->

        <!-- ========================================
         MODULES CRITIQUES - Charg√©s imm√©diatement (8 fichiers au lieu de 55+)
         ======================================== -->

        <!-- ‚ö° SCRIPTS CRITIQUES pour l'authentification (charg√©s en priorit√©) -->
        <script src="js/core/env.js"></script>
        <script src="js/core/auth.js"></script>
        <script src="js/core/utils.js"></script>
        <script src="js/core/dom-optimizer.js"></script>
        <!-- Optimiseur DOM pour r√©duire l'INP -->

        <!-- ‚è≥ TOUS LES AUTRES SCRIPTS EN DEFER POUR NE PAS BLOQUER LE LCP -->

        <!-- Core Performance & Config -->
        <script src="js/core/performance-optimizer.js" defer></script>
        <script src="js/core/performance-monitor.js" defer></script>
        <!-- Moniteur de performance pour mesurer INP/LCP/CLS -->
        <script src="js/core/module-loader-config.js" defer></script>
        <script src="js/core/lazy-loader.js" defer></script>
        <script src="js/core/smart-button-loader.js" defer></script>
        <script src="js/core/module-wrappers.js" defer></script>

        <!-- Core Essentials -->
        <script src="js/core/paths.js" defer></script>
        <script src="js/core/config.js" defer></script>
        <script src="js/core/api-keys-manager.js" defer></script>
        <!-- üÜï Gestionnaire cl√©s API centralis√©es Supabase -->
        <script src="js/core/settings-manager.js" defer></script>
        <!-- üÜï Gestionnaire param√®tres centralis√©s Supabase -->
        <script src="js/core/api-config.js" defer></script>
        <!-- Configuration API automatique dev/prod -->
        <script src="js/core/responsive-manager.js" defer></script>
        <!-- Responsive auto-scale global -->
        <script src="js/core/hr-broadcast.js" defer></script>
        <script src="js/core/thememanager.js" defer></script>

        <!-- Supabase CDN (requis avant autres modules) -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

        <!-- QR Code Generator (utilis√© fr√©quemment) -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
            defer
        ></script>

        <!-- Integrations essentielles (requis par app.js) -->
        <script src="js/integrations/supabasemanager.js" defer></script>
        <script src="js/integrations/discordauth.js" defer></script>
        <script src="js/integrations/discordnotifier.js" defer></script>
        <script src="js/integrations/discord-morning-coach.js" defer></script>

        <!-- AI Session Generator -->
        <script src="js/prompts/session-generator-prompt.js" defer></script>
        <script src="js/config/skali-equipment.js" defer></script>
        <script src="js/config/sports-matrix.js" defer></script>
        <script src="js/config/course-typologies.js" defer></script>
        <script src="js/integrations/ai-session-generator.js" defer></script>
        <script src="js/prompts/flexible-session-prompt.js" defer></script>

        <!-- G√©n√©rateur intelligent La Sk√†li -->
        <script src="js/integrations/laskali-session-types.js" defer></script>
        <script src="js/integrations/smart-session-generator.js" defer></script>
        <script src="js/integrations/simple-session-generator.js?v=3" defer></script>

        <!-- Managers essentiels -->
        <script src="js/managers/viewmanager.js" defer></script>
        <script src="js/managers/permissionmanager.js" defer></script>
        <script src="js/managers/syncmanager.js" defer></script>
        <script src="js/managers/backupmanager.js" defer></script>
        <script src="js/managers/tvmode.js" defer></script>
        <script src="tools/pdfexporter.js" defer></script>

        <!-- Services -->
        <script src="js/services/session-generator-specialized.js" defer></script>

        <!-- Modules business critiques -->
        <script src="js/modules/calendar/calendarmanager.js" defer></script>
        <script src="js/modules/members/membermanager.js" defer></script>
        <!-- memberimport.js est charg√© dynamiquement via LazyLoader -->
        <script src="js/modules/teams/teambuilder.js" defer></script>

        <!-- Pages d√©di√©es (Modules refondus) -->
        <script src="js/modules/morning-coach-page.js" defer></script>
        <script src="js/modules/config-manager-page.js" defer></script>
        <script src="js/modules/admin/gym-inventory-manager.js" defer></script>
        <script src="js/modules/admin/settings-api-keys-ui.js" defer></script>
        <!-- üîë Interface de gestion des cl√©s API Supabase -->

        <!-- Programming Pro - Architecture Modulaire -->
        <script src="js/config/methodologies-database.js" defer></script>
        <script src="js/config/testing-protocols.js" defer></script>
        <script src="js/modules/programming/generators/ai-prompt-builder.js" defer></script>
        <!-- Note: program-generator-ai.js et pdf-generator-pro.js sont charg√©s par le loader ci-dessous -->
        <!-- Programming Pro v2.0 - Loader automatique (Validation + Formats + Sessions r√©elles + AI + PDF) -->
        <script src="js/modules/programming/programming-pro-loader.js" defer></script>
        <script src="js/modules/programming/programming-pro-modular.js" defer></script>

        <script src="js/modules/crm-manager.js" defer></script>
        <script src="js/modules/crm-analytics.js" defer></script>

        <!-- Portals membres -->
        <script src="js/modules/portal/programming-portal.js" defer></script>

        <!-- App Entry Point - DOIT RESTER SANS DEFER -->
        <script src="js/app.js"></script>

        <!-- ========================================
         TOUS LES AUTRES MODULES (45+ fichiers) CHARG√âS √Ä LA DEMANDE
         via LazyLoader quand l'utilisateur clique sur un bouton
         ======================================== -->

        <script>
            // Fonction pour ouvrir/fermer le menu mobile
            window.toggleMobileMenu = function () {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.getElementById('mobileOverlay');
                const body = document.body;

                if (sidebar && overlay) {
                    const isOpen = sidebar.classList.contains('open');
                    if (isOpen) {
                        // Fermer le menu
                        sidebar.classList.remove('open');
                        overlay.classList.remove('active');
                        body.style.overflow = '';
                        body.classList.remove('menu-open');
                        console.log('üì± Menu ferm√© via bouton');
                    } else {
                        // Ouvrir le menu
                        sidebar.classList.add('open');
                        overlay.classList.add('active');
                        body.style.overflow = 'hidden';
                        body.classList.add('menu-open');
                        console.log('üì± Menu ouvert via bouton');
                    }
                }
            };

            // Helper global pour fermer le menu mobile automatiquement
            window.closeMobileMenu = function () {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.getElementById('mobileOverlay');
                const body = document.body;

                if (sidebar && overlay && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                    body.style.overflow = '';
                    body.classList.remove('menu-open');
                    console.log('üì± Menu mobile ferm√©');
                }
            };

            // Fermer le menu quand on clique en dehors (sur l'overlay)
            window.closeMenuOnOverlayClick = function (event) {
                const sidebar = document.querySelector('.sidebar');
                const mobileBtn = document.getElementById('mobileMenuBtn');

                // Si on clique en dehors de la sidebar et du bouton menu
                if (sidebar && sidebar.classList.contains('open')) {
                    if (
                        !sidebar.contains(event.target) &&
                        event.target !== mobileBtn &&
                        !mobileBtn.contains(event.target)
                    ) {
                        sidebar.classList.remove('open');
                        console.log('üì± Menu ferm√© (clic overlay)');
                    }
                }
            };

            // Ajouter l'auto-fermeture √† tous les boutons de navigation
            function attachMenuClosers() {
                document.querySelectorAll('.nav-item').forEach(btn => {
                    // Supprimer les anciens listeners pour √©viter les doublons
                    btn.removeEventListener('click', handleNavClick);
                    // Ajouter le nouveau listener
                    btn.addEventListener('click', handleNavClick);
                });
                console.log(
                    '‚úÖ Auto-fermeture menu attach√©e √†',
                    document.querySelectorAll('.nav-item').length,
                    'boutons'
                );
            }

            function handleNavClick(event) {
                // Fermer le menu mobile apr√®s un court d√©lai
                setTimeout(() => window.closeMobileMenu(), 150);
            }

            // Attacher au chargement de la page
            document.addEventListener('DOMContentLoaded', function () {
                attachMenuClosers();

                // Ajouter le listener pour fermer sur clic overlay
                document.addEventListener('click', window.closeMenuOnOverlayClick);

                // MutationObserver d√©sactiv√© car causait des bugs de scroll
                // Les closers sont attach√©s au DOMContentLoaded, √ßa suffit
            });
        </script>

        <!-- Service Worker D√âSACTIV√â - Causait des probl√®mes de cache -->
        <script>
            // D√©sinscrire tous les Service Workers existants
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    for (let registration of registrations) {
                        registration.unregister();
                        console.log('üóëÔ∏è Service Worker d√©sinscrit');
                    }
                });
            }
        </script>
    </body>
</html>
