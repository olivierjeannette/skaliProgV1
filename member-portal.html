<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="mobile-web-app-capable" content="yes" />
        <title>Portail Adh√©rents - Sk√†li Prog</title>

        <!-- PWA Manifest -->
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#3e8e41" />
        <link rel="apple-touch-icon" href="js/img/logo.webp" />

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Config Tailwind -->
        <script>
            tailwind.config = {
                darkMode: 'class',
                corePlugins: {
                    preflight: false // D√©sactive le reset CSS de Tailwind
                },
                theme: {
                    extend: {
                        colors: {
                            'skali-dark': '#0f172a',
                            'skali-darker': '#0a0f1e',
                            'skali-accent': '#52c759',
                            'wood-accent': '#8b7355'
                        }
                    }
                }
            };
        </script>

        <!-- Master Theme CSS - Variables globales -->
        <link rel="stylesheet" href="css/master-theme.css?v=2.4.7" />

        <!-- Member Portal CSS - Design unifi√© -->
        <link rel="stylesheet" href="css/member-portal.css?v=2.0" />

        <style>
            /* Override Tailwind if needed */
            .container {
                max-width: 100%;
            }
        </style>
    </head>
    <body class="text-gray-100">
        <!-- Navigation moderne -->
        <nav>
            <div class="container">
                <!-- Logo -->
                <div class="nav-logo">
                    <div class="nav-logo-icon">
                        <i class="fas fa-dumbbell"></i>
                    </div>
                    <div class="nav-brand">
                        <h1>Portail Adh√©rent</h1>
                        <p>Sk√†li Prog</p>
                    </div>
                </div>

                <!-- Actions √† droite -->
                <div class="nav-actions">
                    <!-- Bouton D√©connexion -->
                    <button onclick="PortalAuthOAuth.logout()" class="nav-logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>D√©connexion</span>
                    </button>

                    <!-- Menu Hamburger -->
                    <button onclick="toggleMobileMenu()" id="hamburgerBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-3 md:px-4 py-6">
            <!-- √âcran de connexion Discord (par d√©faut) -->
            <div id="discordLoginScreen" class="flex items-center justify-center min-h-[70vh]">
                <div class="glass-card rounded-2xl p-8 max-w-md w-full text-center">
                    <!-- Ic√¥ne Discord anim√©e -->
                    <div class="mb-6 flex justify-center">
                        <div
                            class="w-24 h-24 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full flex items-center justify-center shadow-2xl animate-pulse"
                        >
                            <i class="fab fa-discord text-5xl text-white"></i>
                        </div>
                    </div>

                    <!-- Titre -->
                    <h2 class="text-3xl font-bold text-white mb-3">Portail Adh√©rent</h2>
                    <p class="text-gray-300 mb-8">Connectez-vous une seule fois avec Discord</p>

                    <!-- Bouton de connexion -->
                    <button
                        onclick="PortalAuthOAuth.loginWithDiscord()"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-105 shadow-lg mb-4"
                    >
                        <i class="fab fa-discord mr-2 text-xl"></i>
                        Se connecter avec Discord
                    </button>

                    <!-- Info persistance -->
                    <div
                        class="bg-green-900/30 border border-green-500/50 rounded-lg p-4 text-left mb-4"
                    >
                        <div class="flex items-start gap-3">
                            <i class="fas fa-mobile-alt text-green-400 text-lg mt-1"></i>
                            <div class="text-sm text-gray-300">
                                <p class="font-semibold text-white mb-1">
                                    üì± Connexion sauvegard√©e sur votre t√©l√©phone
                                </p>
                                <p>
                                    Vous restez connect√© pendant
                                    <strong class="text-green-400">90 jours</strong> - plus besoin
                                    de vous reconnecter √† chaque visite !
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Info s√©curit√© -->
                    <div class="bg-blue-900/30 border border-blue-500/50 rounded-lg p-4 text-left">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-shield-alt text-blue-400 text-lg mt-1"></i>
                            <div class="text-sm text-gray-300">
                                <p class="font-semibold text-white mb-1">Pourquoi Discord ?</p>
                                <p>
                                    Pour prot√©ger vos donn√©es et garantir que seul vous puissiez
                                    acc√©der √† vos performances.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Zone de contenu dynamique (cach√©e par d√©faut) -->
            <div id="contentArea" class="hidden glass-card rounded-xl p-4 md:p-8">
                <div class="text-center py-8 md:py-12">
                    <i class="fas fa-arrow-up text-4xl md:text-6xl text-green-400 mb-3 md:mb-4"></i>
                    <h2 class="text-2xl md:text-3xl font-bold text-white mb-3 md:mb-4">
                        Bienvenue !
                    </h2>
                    <p class="text-base md:text-xl text-gray-300">
                        S√©lectionnez une option ci-dessus
                    </p>
                </div>
            </div>
        </div>

        <!-- Bottom safe area for iOS -->
        <div class="h-8 md:h-0"></div>

        <!-- Supabase Client -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

        <!-- html2canvas for PNG export -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <!-- MediaPipe Pose pour analyse vid√©o -->
        <script
            src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
            crossorigin="anonymous"
        ></script>

        <!-- Chart.js pour les graphiques -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

        <!-- ‚ö° PORTAIL ADH√âRENT - DESIGN UNIFI√â (master-theme + member-portal) ‚ö° -->

        <!-- Note: Les anciens CSS portal-*.css ne sont plus utilis√©s -->
        <!-- Le nouveau member-portal.css h√©rite des variables du master-theme.css -->
        <!-- Nutrition Portal reste pour les fonctionnalit√©s nutrition sp√©cifiques -->
        <link rel="stylesheet" href="css/nutrition-portal.css" />

        <!-- Scripts -->
        <script src="js/core/env.js"></script>
        <script src="js/core/utils.js"></script>
        <script src="js/core/config.js"></script>
        <script src="js/core/hr-broadcast.js"></script>
        <script src="js/integrations/supabasemanager.js"></script>
        <script src="js/modules/discord-oauth.js"></script>
        <script src="js/modules/portal-auth-oauth.js"></script>
        <script src="js/modules/pokemon/performance-normalizer.js"></script>
        <script src="js/modules/pokemon/performance-stats-v2.js"></script>
        <script src="js/modules/pokemon-portal.js"></script>
        <!-- Body Analysis & Morphology -->
        <!-- <script src="js/modules/nutrition/body-analysis.js"></script> -->
        <!-- body-morphology.js est d√©j√† int√©gr√© dans body-analysis.js -->
        <!-- Video AI (n√©cessite body-morphology) -->
        <!-- <script src="js/modules/video-ai.js"></script> -->
        <!-- Note: Fichiers comment√©s car non pr√©sents dans le projet -->
        <!-- Nutrition Portal -->
        <script src="js/modules/portal/nutrition-portal.js"></script>
        <!-- Programming Portal -->
        <script src="js/modules/portal/programming-portal.js"></script>
        <script src="js/modules/member-portal.js?v=4"></script>
        <script src="js/modules/portal-mobile-menu.js"></script>

        <script>
            // Attendre que Supabase et PortalAuthOAuth soient pr√™ts
            setTimeout(async () => {
                console.log('üöÄ Initialisation du portail adh√©rents...');

                // Initialiser ENV d'abord
                if (typeof ENV !== 'undefined') {
                    await ENV.init();
                    console.log('‚úÖ ENV initialis√©');
                }

                // Initialiser Supabase
                if (typeof SupabaseManager !== 'undefined') {
                    await SupabaseManager.init();
                    console.log('‚úÖ Supabase initialis√©');
                }

                // Initialiser PortalAuthOAuth (syst√®me OAuth automatique)
                if (typeof PortalAuthOAuth !== 'undefined') {
                    await PortalAuthOAuth.init();
                    console.log('‚úÖ PortalAuthOAuth initialis√©');
                }
            }, 500);

            // Gestion de l'activation des boutons
            function setActiveNav(btnId) {
                // R√©initialiser tous les boutons au style inactif
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.className =
                        'nav-btn group relative flex items-center justify-center w-12 h-12 md:w-auto md:px-4 md:py-2 rounded-xl bg-gray-800/80 hover:bg-gray-700/80 text-gray-300 hover:text-white font-semibold transition-all duration-300 touch-active';
                });

                // Activer le bouton s√©lectionn√© avec style actif
                const activeBtn = document.getElementById(btnId);
                if (activeBtn) {
                    activeBtn.className =
                        'nav-btn group relative flex items-center justify-center w-12 h-12 md:w-auto md:px-4 md:py-2 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white font-semibold transition-all duration-300 touch-active shadow-lg hover:shadow-green-500/50';
                }
            }

            // Fonctions de navigation
            function showHome() {
                setActiveNav('navHome');
                MemberPortal.showHomeSection();
            }

            function showDataEntry() {
                setActiveNav('navDataEntry');
                MemberPortal.showDataEntrySection();
            }

            function showCardGallery() {
                setActiveNav('navCards');
                MemberPortal.showCardGallerySection();
            }

            function showGoals() {
                setActiveNav('navGoals');
                MemberPortal.showGoalsSection();
            }

            function showPerformances() {
                setActiveNav('navPerformances');
                MemberPortal.showPerformancesSection();
            }

            function showVideoAI() {
                setActiveNav('navVideoAI');
                MemberPortal.showVideoAISection();
            }

            function showNutrition() {
                setActiveNav('navNutrition');
                // Charger le module Nutrition Portal
                if (typeof NutritionPortal !== 'undefined') {
                    NutritionPortal.init();
                } else {
                    console.error('‚ùå Module NutritionPortal non charg√©');
                }
            }

            function showProgramming() {
                setActiveNav('navProgramming');
                // Charger le module Programming Portal
                if (typeof ProgrammingPortal !== 'undefined') {
                    ProgrammingPortal.init();
                } else {
                    console.error('‚ùå Module ProgrammingPortal non charg√©');
                }
            }

            // =============================================
            // SERVICE WORKER - PWA
            // =============================================
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker
                        .register('/sw.js')
                        .then(registration => {
                            console.log('‚úÖ Service Worker enregistr√©:', registration.scope);
                        })
                        .catch(error => {
                            console.error('‚ùå Erreur Service Worker:', error);
                        });
                });
            }
        </script>
    </body>
</html>
